define(["i18n!nls/locale","component","text!templet/calendar_window_eventSave.html","moment","moment-timezone","jquery.datetimepicker","wysihtml5","wysihtml5-config"],function(e,t,n,r){app.views.calendar_window_eventSave=Backbone.View.extend({el:"#component_window_wrapper",model:null,initialize:function(e){e&&(this.model=e)},events:{"click #button_save_event":"onSave","click #button_delete":"onDelete","change #select_event_class":"onChangeTheme","change #input_event_start":function(){$("#input_event_end").val($("#input_event_start").val())}},onSave:function(){var n=$("input[name=EVENT_NAME]").val(),i=r($("input[name=EVENT_START]").val()).unix(),s=r($("input[name=EVENT_END]").val()).unix(),o=$("textarea[name=EVENT_INTRO]").val(),u=$("#select_event_class").val(),a=$("#select_event_permission").val(),f=$("#select_event_owner").val(),l=1;!n||!i||!s?(l=0,t.alert({TITLE:e.root.dialog.title_error,MESSAGE:e.root.dialog.content_not_completed,BUTTON_TRUE_TITLE:e.root.dialog.button_true})):i>s&&(l=0,t.alert({TITLE:e.root.dialog.title_error,MESSAGE:e.root.dialog.time_range_error,BUTTON_TRUE_TITLE:e.root.dialog.button_true})),l&&(this.model||(this.model=new app.models.event),this.model.set("name",n),this.model.set("start",i),this.model.set("end",s),this.model.set("intro",o),this.model.set("className",u),this.model.set("id_user",f),this.model.set("permission",a),this.model.save(),t.component_window_remove())},onDelete:function(){t.confirm({TITLE:e.root.dialog.title_confirm,MESSAGE:e.root.component_window.common.title_delete_confirm,BUTTON_TRUE_TITLE:e.root.dialog.button_true,BUTTON_FALSE_TITLE:e.root.dialog.button_false,CALLBACK_TRUE:_.bind(function(){t.dialogRemove(),this.model.destroy(),t.component_window_remove()},this)})},onChangeTheme:function(e){$("#select_event_class").removeClass().addClass("select").addClass($("#select_event_class").val())},render:function(e){this.template=_.template(n),this.model?this.$el.html(this.template({EVENT_NAME:this.model.get("name"),EVENT_START:r.unix(this.model.get("start")).format("YYYY-MM-DD"),EVENT_END:r.unix(this.model.get("end")).format("YYYY-MM-DD"),EVENT_INTRO:this.model.get("intro"),EVENT_CLASS:this.model.get("className"),EVENT_PERMISSION:this.model.get("permission"),EVENT_OWNER:this.model.get("id_user")})):this.$el.html(this.template({EVENT_NAME:"",EVENT_START:e,EVENT_END:e,EVENT_INTRO:"",EVENT_CLASS:"fc-green",EVENT_PERMISSION:"public",EVENT_OWNER:app.instances.models.user.get("id")}));var t="en";localStorage.getItem("locale")=="zh-cn"&&(t="ch"),$("#input_event_start").datetimepicker({lazyInit:!0,lang:t,timepicker:!1,closeOnDateSelect:!0,format:"Y-m-d"}),$("#input_event_end").datetimepicker({lazyInit:!0,lang:t,timepicker:!1,closeOnDateSelect:!0,format:"Y-m-d"});var i=new wysihtml5.Editor("editor",{toolbar:"editor_toolbar",parserRules:wysihtml5ParserRules});return this}})});