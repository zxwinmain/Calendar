define(["i18n!nls/locale","view/component_windowView","text!templet/component_dialogView.html","text!templet/component_promptView.html","text!templet/appContainerView.html"],function(e,t,n,r,i){var s=function(t,n,r,i){$.ajax({dataType:"json",type:n,url:t+"?request_type=json&"+(new Date).valueOf(),data:r,success:function(e){e&&o(e,function(){i&&i(e)})},error:function(t){f({TITLE:e.root.dialog.title_error,MESSAGE:e.root.dialog.network_broken,BUTTON_TRUE_TITLE:e.root.dialog.button_true})}})},o=function(t,n){t.succeed?n():t.response.message=="INVALID_TOKEN"?f({TITLE:e.root.dialog.title_error,MESSAGE:e.root.dialog.signin_invalid_password,BUTTON_TRUE_TITLE:e.root.dialog.button_true}):t.response.message=="EMAIL_EXISTS"?f({TITLE:e.root.dialog.title_error,MESSAGE:e.root.dialog.invite_invalid_email,BUTTON_TRUE_TITLE:e.root.dialog.button_true}):t.response.message=="FOLDER_EXISTS"?f({TITLE:e.root.dialog.title_error,MESSAGE:e.root.dialog.storage_invalid_folder,BUTTON_TRUE_TITLE:e.root.dialog.button_true}):t.response.message=="FOLDER_NOT_EMPTY"?f({TITLE:e.root.dialog.title_error,MESSAGE:e.root.dialog.storage_folder_not_empty,BUTTON_TRUE_TITLE:e.root.dialog.button_true}):t.response.message=="APP_INVALID"&&Backbone.history.navigate("app",{trigger:!0})},u=function(e,t){$("#component_dialog").remove();var i={TYPE:e,TITLE:"TITLE",MESSAGE:"MESSAGE",BUTTON_TRUE_TITLE:"Ok",BUTTON_FALSE_TITLE:"Cancel"};t.TITLE&&(i.TITLE=t.TITLE),t.MESSAGE&&(i.MESSAGE=t.MESSAGE),t.BUTTON_TRUE_TITLE&&(i.BUTTON_TRUE_TITLE=t.BUTTON_TRUE_TITLE),t.BUTTON_FALSE_TITLE&&(i.BUTTON_FALSE_TITLE=t.BUTTON_FALSE_TITLE),i.TYPE=="PROMPT"?$("body").append(_.template(r)(i)):$("body").append(_.template(n)(i)),$("#component_dialog").fadeIn(100,function(){$("#component_dialog").on("click","#component_dialog_true",function(){t.CALLBACK_TRUE?t.CALLBACK_TRUE():a(),$("#component_dialog #component_dialog_true").focus()}),$("#component_dialog").on("click","#component_dialog_false",function(){t.CALLBACK_FALSE?t.CALLBACK_FALSE():a(),$("#component_dialog #component_dialog_false").focus()})})},a=function(){$("#component_dialog").fadeOut(100,function(){$(this).remove()})},f=function(e){u("ALERT",e)},l=function(e){u("CONFIRM",e)},c=function(e){u("PROMPT",e)},h=function(e,t){$("body").append((new app.views.component_window(d)).render(e).el),t&&t()},p=function(e){var t=$(e.currentTarget);t.attr("data-tab")=="signout"?location.href="/signout":($("#component_window_inner .component_window_inner_tab").hide(),$("#component_window_inner .component_window_inner_tab[data-tab="+t.attr("data-tab")+"]").show(),$("ul.swicher a").removeClass("active"),t.addClass("active"))},d=function(e){$("input[data-mark=dateTimePicker]").each(function(){$(this).datetimepicker("destroy")}),$("body > div.xdsoft_datetimepicker").remove(),$("#component_window").parent().remove(),e&&$(document).unbind("keydown",e)},v=function(e){m(e,function(t){Backbone.history.navigate("app/"+e),$("#workspace").html(_.template(i)({URL:t.URL+"?token="+t.TOKEN}))})},m=function(e,t){s("/api/apps/"+e,"GET",null,function(e){t({URL:e.response.BODY_URL,TOKEN:e.response.USER_TOKEN})})},g=function(e){var t=app.instances.collections.users.where({id:e});return t[0].get("name")},y=function(e){var t=new Object,n=location.search.substring(1),r=n.split("&");for(var i=0;i<r.length;i++){var s=r[i].indexOf("=");if(s==-1)continue;var o=r[i].substring(0,s),u=r[i].substring(s+1);t[o]=decodeURIComponent(u)}return t[e]},b=function(e){return/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(e)},w=function(e){return/(?!^\\d+$)(?!^[a-zA-Z]+$)(?!^[_#@]+$).{8,}/.test(e)},E=function(e){if(e===0)return"0 B";var t=1024,n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(t));return(e/Math.pow(t,r)).toPrecision(3)+" "+n[r]};return{api_call:s,dialog:u,dialogRemove:a,alert:f,confirm:l,prompt:c,isEmail:b,isPassword:w,load_user_name:g,load_requested_param:y,bytes_to_size:E,component_window:h,component_window_tab:p,component_window_remove:d,application:v}});