(function(e){e.fn.AjaxFileUpload=function(t){function s(n){var i=e(n.target),s=i.attr("id"),l=i.removeAttr("id").clone().attr("id",s).AjaxFileUpload(t),c=i.val().replace(/.*(\/|\\)/,""),h=a(),p=f(h);l.insertBefore(i),r.onChange.call(l[0],c),h.bind("load",{element:l,form:p,filename:c},u),p.append(i).bind("submit",{element:l,iframe:h,filename:c},o).submit()}function o(t){var n=r.onSubmit.call(t.data.element,t.data.filename);if(n===!1)return e(t.target).remove(),t.data.iframe.remove(),!1;for(var i in n)e("<input />").attr("type","hidden").attr("name",i).val(n[i]).appendTo(t.target)}function u(t){var n=e(t.target),i=(n[0].contentWindow||n[0].contentDocument).document,s=i.body.innerHTML;s?s=e.parseJSON(s):s={},r.onComplete.call(t.data.element,t.data.filename,s),t.data.form.remove(),n.remove()}function a(){var t=i();return e("body").append('<iframe src="javascript:false;" name="'+t+'" id="'+t+'" style="display: none;"></iframe>'),e("#"+t)}function f(t){return e("<form />").attr({method:"post",action:r.action,enctype:"multipart/form-data",target:t[0].name}).hide().appendTo("body")}var n={action:"upload.php",onChange:function(e){},onSubmit:function(e){},onComplete:function(e,t){}},r=e.extend({},n,t),i=function(){var e=0;return function(){return"_AjaxFileUpload"+e++}}();return this.each(function(){var t=e(this);t.is("input")&&t.attr("type")==="file"&&t.bind("change",s)})}})(jQuery);